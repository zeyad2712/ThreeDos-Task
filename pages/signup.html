<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up - Smart Login System</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">

    <!-- Font Awesome  -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"
        integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">

    <!-- CSS Link -->
    <link rel="stylesheet" href="../css/style.css">
</head>

<body>
    <div class="container-fluid vh-100">
        <div class="row h-100">
            <!-- Left Side - Image/Content -->
            <div class="col-lg-6 d-none d-lg-flex align-items-center justify-content-center bg-gradient-primary">
                <div class="text-center text-white slide-in-left">
                    <i class="fas fa-user-plus fa-5x mb-4"></i>
                    <h3 class="fw-bold">Join Our Community</h3>
                    <p class="lead">Create your account and start your journey with us</p>
                </div>
            </div>

            <!-- Right Side - Signup Form -->
            <div class="col-lg-6 d-flex align-items-center justify-content-center bg-white">
                <div class="signup-form-container w-100 px-3 fade-in" style="max-width: 500px;">
                    <div class="text-center mb-3">
                        <div class="mb-2">
                            <i class="fas fa-user-plus fa-2x text-primary"></i>
                        </div>
                        <h3 class="fw-bold text-primary mb-1">Create Account</h3>
                        <p class="text-muted mb-0 small">Join our community and start your journey</p>
                    </div>

                    <form id="signupForm" class="needs-validation" novalidate>
                        <!-- Compact Form Layout -->
                        <div class="row g-3">
                            <!-- Full Name -->
                            <div class="col-12">
                                <label for="fullName" class="form-label small">Full Name</label>
                                <div class="input-group input-group-sm">
                                    <span class="input-group-text"><i class="fas fa-user"></i></span>
                                    <input type="text" class="form-control" id="fullName" name="fullName"
                                        placeholder="Enter your full name" required>
                                    <div class="invalid-feedback">
                                        Please provide your full name.
                                    </div>
                                </div>
                            </div>

                            <!-- Email -->
                            <div class="col-12">
                                <label for="signupEmail" class="form-label small">Email Address</label>
                                <div class="input-group input-group-sm">
                                    <span class="input-group-text"><i class="fas fa-envelope"></i></span>
                                    <input type="email" class="form-control" id="signupEmail" name="email"
                                        placeholder="Enter your email address" required>
                                    <div class="invalid-feedback">
                                        Please provide a valid email address.
                                    </div>
                                </div>
                            </div>

                            <!-- Phone and Gender -->
                            <div class="col-md-6">
                                <label for="phoneNumber" class="form-label small">Phone Number</label>
                                <div class="input-group input-group-sm">
                                    <span class="input-group-text"><i class="fas fa-phone"></i></span>
                                    <input type="tel" class="form-control" id="phoneNumber" name="phone"
                                        placeholder="+1 (555) 123-4567" required>
                                    <div class="invalid-feedback">
                                        Please provide a valid phone number.
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label for="gender" class="form-label small">Gender</label>
                                <div class="input-group input-group-sm">
                                    <span class="input-group-text"><i class="fas fa-venus-mars"></i></span>
                                    <select class="form-control" id="gender" name="gender" required>
                                        <option value="">Select Gender</option>
                                        <option value="male">Male</option>
                                        <option value="female">Female</option>
                                        <option value="other">Other</option>
                                        <option value="prefer_not_to_say">Prefer not to say</option>
                                    </select>
                                    <div class="invalid-feedback">
                                        Please select your gender.
                                    </div>
                                </div>
                            </div>

                            <!-- Password and Confirm Password -->
                            <div class="col-md-6">
                                <label for="signupPassword" class="form-label small">Password</label>
                                <div class="input-group input-group-sm">
                                    <span class="input-group-text"><i class="fas fa-lock"></i></span>
                                    <input type="password" class="form-control" id="signupPassword" name="password"
                                        placeholder="Password123 (8+ chars, upper, lower, digit)" required>
                                    <button class="btn btn-outline-secondary" type="button" id="toggleSignupPassword">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <div class="invalid-feedback">
                                        Please provide a password.
                                    </div>
                                </div>
                                <div class="form-text">
                                    <small class="text-muted">
                                        <i class="fas fa-info-circle me-1"></i>
                                        Must be 8+ characters with uppercase, lowercase, and digit
                                    </small>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label for="confirmPassword" class="form-label small">Confirm Password</label>
                                <div class="input-group input-group-sm">
                                    <span class="input-group-text"><i class="fas fa-lock"></i></span>
                                    <input type="password" class="form-control" id="confirmPassword"
                                        name="confirmPassword" placeholder="Confirm your password" required>
                                    <button class="btn btn-outline-secondary" type="button" id="toggleConfirmPassword">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <div class="invalid-feedback">
                                        Passwords do not match.
                                    </div>
                                </div>
                            </div>

                            <!-- Terms and Conditions -->
                            <div class="col-12">
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" id="agreeTerms" required>
                                    <label class="form-check-label small" for="agreeTerms">
                                        I agree to the <a href="#" class="text-primary text-decoration-none">Terms and
                                            Conditions</a> and <a href="#"
                                            class="text-primary text-decoration-none">Privacy Policy</a>
                                    </label>
                                    <div class="invalid-feedback">
                                        You must agree to the terms and conditions.
                                    </div>
                                </div>
                            </div>

                            <!-- Submit Button -->
                            <div class="col-12">
                                <button type="submit" class="btn btn-primary w-100 py-2" id="signupBtn">
                                    <span class="spinner-border spinner-border-sm d-none" role="status"
                                        aria-hidden="true"></span>
                                    <i class="fas fa-user-plus me-2"></i>
                                    Create Account
                                </button>
                            </div>
                        </div>
                    </form>

                    <div class="text-center mt-3">
                        <p class="text-muted small">Already have an account? <a href="index.html"
                                class="text-decoration-none fw-bold">Sign in</a></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- OTP Verification Modal -->
    <div class="modal fade" id="otpModal" tabindex="-1" aria-labelledby="otpModalLabel" aria-hidden="true"
        data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="otpModalLabel">Verify Your Email</h5>
                </div>
                <div class="modal-body">
                    <div class="text-center mb-4">
                        <i class="fas fa-envelope-open-text fa-3x text-primary mb-3"></i>
                        <p class="text-muted">We've sent a verification code to your email address</p>
                        <p class="fw-bold" id="otpEmail"></p>
                    </div>

                    <form id="signupOtpForm">
                        <div class="mb-3">
                            <label for="signupOtpCode" class="form-label">Enter OTP Code</label>
                            <input type="text" class="form-control text-center" id="signupOtpCode" maxlength="6"
                                required style="font-size: 1.5rem; letter-spacing: 0.5rem;">
                            <div class="form-text">Enter the 6-digit code sent to your email</div>
                        </div>
                        <div class="d-grid">
                            <button type="submit" class="btn btn-success btn-lg" id="verifySignupOtpBtn">
                                <span class="spinner-border spinner-border-sm d-none" role="status"
                                    aria-hidden="true"></span>
                                Verify & Complete Signup
                            </button>
                        </div>
                    </form>

                    <div class="text-center mt-3">
                        <p class="text-muted">Didn't receive the code? <a href="#" class="text-decoration-none"
                                id="resendOtpLink">Resend</a></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
        crossorigin="anonymous"></script>

    <script>
        $(document).ready(function () {
            // API Configuration
            const API_BASE_URL = 'https://thetically-impressible-arla.ngrok-free.dev';

            // Password visibility toggle
            $('#toggleSignupPassword').click(function () {
                const passwordField = $('#signupPassword');
                const icon = $(this).find('i');

                if (passwordField.attr('type') === 'password') {
                    passwordField.attr('type', 'text');
                    icon.removeClass('fa-eye').addClass('fa-eye-slash');
                } else {
                    passwordField.attr('type', 'password');
                    icon.removeClass('fa-eye-slash').addClass('fa-eye');
                }
            });

            $('#toggleConfirmPassword').click(function () {
                const passwordField = $('#confirmPassword');
                const icon = $(this).find('i');

                if (passwordField.attr('type') === 'password') {
                    passwordField.attr('type', 'text');
                    icon.removeClass('fa-eye').addClass('fa-eye-slash');
                } else {
                    passwordField.attr('type', 'password');
                    icon.removeClass('fa-eye-slash').addClass('fa-eye');
                }
            });

            // Form validation
            $('#signupForm').on('submit', function (e) {
                e.preventDefault();

                const form = this;
                if (!form.checkValidity()) {
                    e.stopPropagation();
                    form.classList.add('was-validated');
                    return;
                }

                // Check if passwords match
                const password = $('#signupPassword').val();
                const confirmPassword = $('#confirmPassword').val();

                if (password !== confirmPassword) {
                    $('#confirmPassword').addClass('is-invalid');
                    return;
                } else {
                    $('#confirmPassword').removeClass('is-invalid');
                }

                // Prepare form data
                const formData = {
                    fullName: $('#fullName').val(),
                    email: $('#signupEmail').val(),
                    password: password,
                    confirmPassword: confirmPassword,
                    phone: $('#phoneNumber').val(),
                    gender: $('#gender').val()
                };

                // Show loading state
                const submitBtn = $('#signupBtn');
                const spinner = submitBtn.find('.spinner-border');
                const icon = submitBtn.find('i');

                submitBtn.prop('disabled', true);
                spinner.removeClass('d-none');
                icon.addClass('d-none');

                // Send AJAX request
                $.ajax({
                    url: API_BASE_URL + '/auth/signup/',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(formData),
                    success: function (response) {
                        // Success - show OTP modal
                        $('#otpEmail').text(formData.email);
                        $('#otpModal').modal('show');

                        // Reset form
                        form.reset();
                        form.classList.remove('was-validated');
                    },
                    error: function (xhr, status, error) {
                        // Handle errors
                        let errorMessage = 'An error occurred. Please try again.';

                        if (xhr.responseJSON && xhr.responseJSON.message) {
                            errorMessage = xhr.responseJSON.message;
                        } else if (xhr.responseJSON && xhr.responseJSON.error) {
                            errorMessage = xhr.responseJSON.error;
                        }

                        // Show error message (you can customize this)
                        alert('Error: ' + errorMessage);
                    },
                    complete: function () {
                        // Reset button state
                        submitBtn.prop('disabled', false);
                        spinner.addClass('d-none');
                        icon.removeClass('d-none');
                    }
                });
            });

            // OTP form submission
            $('#signupOtpForm').on('submit', function (e) {
                e.preventDefault();

                const otpCode = $('#signupOtpCode').val();

                if (otpCode.length !== 6) {
                    alert('Please enter a valid 6-digit OTP code.');
                    return;
                }

                // Show loading state
                const verifyBtn = $('#verifySignupOtpBtn');
                const spinner = verifyBtn.find('.spinner-border');

                verifyBtn.prop('disabled', true);
                spinner.removeClass('d-none');

                // Send OTP verification request
                $.ajax({
                    url: API_BASE_URL + '/auth/confirm-email',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        email: $('#otpEmail').text(),
                        otp: otpCode
                    }),
                    success: function (response) {
                        // Success - redirect to login or dashboard
                        alert('Account created successfully! Please sign in.');
                        window.location.href = 'profile.html';
                    },
                    error: function (xhr, status, error) {
                        let errorMessage = 'Invalid OTP code. Please try again.';

                        if (xhr.responseJSON && xhr.responseJSON.message) {
                            errorMessage = xhr.responseJSON.message;
                        }

                        alert('Error: ' + errorMessage);
                    },
                    complete: function () {
                        verifyBtn.prop('disabled', false);
                        spinner.addClass('d-none');
                    }
                });
            });

            // Resend OTP functionality
            $('#resendOtpLink').click(function (e) {
                e.preventDefault();

                const email = $('#otpEmail').text();

                $.ajax({
                    url: API_BASE_URL + '/auth/resend-otp',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        email: email
                    }),
                    success: function (response) {
                        alert('OTP code has been resent to your email.');
                    },
                    error: function (xhr, status, error) {
                        alert('Failed to resend OTP. Please try again.');
                    }
                });
            });
        });
    </script>
</body>

</html>